# Gravity Volume Control 🪨🔊

[![Platform](https://img.shields.io/badge/platform-macOS%2013.0+-blue.svg)](https://www.apple.com/macos/)
[![Swift](https://img.shields.io/badge/Swift-6.0-orange.svg)](https://swift.org/)
[![Tests](https://img.shields.io/badge/tests-48%20passed-brightgreen.svg)](#テスト)
[![License](https://img.shields.io/badge/license-MIT-lightgrey.svg)](../../LICENSE)
[![トラックパッド破壊](https://img.shields.io/badge/トラックパッド破壊-確実-red.svg)](#免責事項)
[![開発者の正気](https://img.shields.io/badge/開発者の正気-疑わしい-yellow.svg)](#免責事項)

**🌍 [English](../../README.md) | [简体中文](README_zh-CN.md) | [繁體中文](README_zh-TW.md) | [Русский](README_ru.md) | [فارسی](README_fa.md) | [العربية](README_ar.md)**

---

## 🏆 おめでとうございます！世界で最も不便な音量コントローラーを発見しました

> *「スライダーがあるのに、なぜ重力を使わないの？」* — 誰も言ってない

**Gravity Volume Control** は、あなたの大切なMacBookのForce Touchトラックパッドを **音量も調整できる20万円超のキッチンスケール** に変えます。だって、ボタンを押すのは簡単すぎたから。

### 🍴 愛を込めてフォーク（判断力は疑問）

この最悪なUXの傑作は [KrishKrosh/TrackWeight](https://github.com/KrishKrosh/TrackWeight) のフォークです — 「ねえ、音量調整に物理学の学位が必要だったらどうする？」と考えた元祖の天才です。

私たちはそのアイデアを ~~さらに悪く~~ *機能豊富に* しました。

---

## 🎬 カオスをご覧ください

https://github.com/user-attachments/assets/7eaf9e0b-3dec-4829-b868-f54a8fd53a84

*はい、本物の人間です。はい、本当に物で音量を調整しています。いいえ、私たちにも理由はわかりません。*

---

## 📖 目次

- [「体験」](#-一日を台無しにする方法使い方)
- [必要環境](#-自滅の条件必要環境)
- [インストール](#-後悔のインストール)
- [開発](#-開発苦痛の旅)
- [アーキテクチャ](#-アーキテクチャジョークのための過剰設計)
- [学べること](#-学べること唯一の救い)
- [コントリビュート](#-コントリビュート苦しみは分かち合うもの)
- [免責事項](#️-免責事項これはマジで読んで)

---

## 🤡 一日を台無しにする方法（使い方）

1. **アプリを起動** して、すぐに人生の選択を疑う
2. **トラックパッドに指を置く**（導電のため必須、まるで人間のアース線）
3. **指の横に「重り」を置く**
   - 🪶 **軽いもの（消しゴム）** → 🔈 静か、後悔のように
   - 🍺 **重いもの（満タンのマグカップ）** → 🔊 うるさい、同僚の「なんで？」のように
4. **動画を見ている間ずっとその物を置き続ける**
   - どかしたら？ **即ミュート。**
   - くしゃみしたら？ **ミュート。**
   - 猫が通ったら？ **カオス。**
   - 実際にパソコンを使いたい？ **残念でした。**

### 💡 誰も聞いてないプロのコツ

- コーヒーマグは最高...30万円のMacBook Proにコーヒーをこぼすまでは
- スマホは完璧な重さ...誰かから電話がかかってくるまでは
- 教科書は安定した音量を提供...そして学生ローンを思い出させる
- あなたのプライドは重さゼロなので音量調整に使えません

---

## 💀 自滅の条件（必要環境）

| 項目 | 要件 | 現実確認 |
|------|------|----------|
| OS | macOS 13.0以上 | モダンなAPIで時代遅れなことをするため |
| ハードウェア | Force Touch トラックパッド | 今から酷使される3万円のパーツ |
| Xcode | 16.0以上 | 後悔をコンパイルするため |
| Swift | 6.0 | モダンな言語、古代の知恵：「やめとけ」 |
| 正気 | オプション | 明らかに私たちには無かった |

> **⚠️ 重要:** 外部トラックパッドでは動作しません。Appleは明らかにMagic Trackpadを「マグカップを置きたく*ない*人」向けに設計しました。臆病者め。

---

## 📦 後悔のインストール

### Homebrew（見知らぬ人を信じる人向け）

```bash
# 本当にやるの？
brew install --cask gravity-volume-control
```

### 手動インストール（コントロールフリーク向け）

1. [Releases](https://github.com/clearclown/volumeControlWithTrackWeight/releases) から `.dmg` をダウンロード（あまり審判しません...たぶん）
2. `/Applications` にドラッグ（もう戻れない）
3. macOSが「開発元を確認できません」と言ったら — まあ、そうだろうね

### ソースからビルド（マゾヒスト向け）

```bash
git clone https://github.com/clearclown/volumeControlWithTrackWeight.git
cd volumeControlWithTrackWeight

# ジョークのために1700行以上のコードをコンパイル
xcodebuild build -scheme TrackWeight -destination 'platform=macOS'

# おめでとう、悪い決断を量産できるようになりました
```

---

## 🛠 開発（苦痛の旅）

### 開発哲学: TDD (Tragedy-Driven Development / 悲劇駆動開発)

このプロジェクトは **テスト駆動開発** に従っています。無駄なものを作るなら、*正しく* 作ろうということで。

- ✅ 機能の前にテストを書く（私たちが唯一責任を持ってやること）
- ✅ 48のテスト、全てパス（アプリは動く、ただ...なんで？）
- ✅ テスト可能性のための依存性注入（だってプロフェッショナル™だから）

### テストカバレッジ（唯一の誇り）

| テストスイート | テスト数 | 証明すること |
|----------------|----------|--------------|
| `ScaleViewModelTests` | 17 | 秤は動く。残念ながら。 |
| `WeighingViewModelTests` | 24 | 重量検出は正確。やったね。 |
| `WeighingStateTests` | 7 | ステートマシンは動く。やったー？ |
| **合計** | **48** | コンセプトよりテストに労力をかけた |

```bash
# テストを実行（唯一意味のあるコマンド）
xcodebuild test -scheme TrackWeight -destination 'platform=macOS' \
  -only-testing:TrackWeightTests
```

---

## 🏗 アーキテクチャ（ジョークのための過剰設計）

**MVVM** を使用しました。バカなことをするなら、適切なソフトウェアアーキテクチャでやろう。

```
┌─────────────────────────────────────────────────────────────────┐
│                      後悔のフロー                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐     ┌─────────────────────┐                  │
│  │ あなたのマグ  │────▶│  Force Touch センサー│                  │
│  │  (無垢)      │     │    (酷使中)         │                  │
│  └──────────────┘     └──────────┬──────────┘                  │
│                                  │                              │
│                                  ▼                              │
│                    ┌─────────────────────────┐                 │
│                    │ OpenMultitouchSupport   │                 │
│                    │   (盗んだPrivate API)   │                 │
│                    └──────────┬──────────────┘                 │
│                               │                                 │
│                               ▼                                 │
│         ┌─────────────────────────────────────────┐            │
│         │            ViewModel レイヤー            │            │
│         │  ┌─────────────┐  ┌─────────────────┐  │            │
│         │  │ ScaleVM     │  │ WeighingVM      │  │            │
│         │  │ (計算)      │  │ (もっと計算)     │  │            │
│         │  └─────────────┘  └─────────────────┘  │            │
│         └───────────────────┬─────────────────────┘            │
│                             │                                   │
│              ┌──────────────┴──────────────┐                   │
│              ▼                              ▼                   │
│    ┌──────────────────┐          ┌─────────────────┐           │
│    │   SwiftUI View   │          │  System Audio   │           │
│    │ (ほぼ無意味)     │          │  (実際の変更)   │           │
│    └──────────────────┘          └─────────────────┘           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### データフロー（4幕の悲劇）

1. **第1幕:** あなたのマグカップが無邪気にトラックパッドの上に座る
2. **第2幕:** 使うべきじゃないPrivate APIが圧力データをキャプチャ
3. **第3幕:** 複雑な信号処理（移動平均、ノイズ除去）で重量を計算
4. **第4幕:** システム音量が変わる。同僚があなたを審判する。

### 信号処理パラメータ（マジで真剣です）

| パラメータ | 値 | なぜ必要か |
|------------|-----|-----------|
| `historySize` | 10 | 移動平均ウィンドウ（コーヒーが揺れる） |
| `rateOfChangeThreshold` | 5.0 | 物体検出（電話？ホッチキス？） |
| `stabilityThreshold` | 2.0 | 重量を受け入れるタイミング（震えるな！） |
| `stabilityDuration` | 3.0秒 | 待機時間（永遠より短く感じる） |

---

## 📚 学べること（唯一の救い）

さて、本音を言うと。完全にイカれてるにも関わらず、このプロジェクトは学習の宝庫です：

### 1. 🔓 Apple Private API（グレーゾーン速攻）

禁断の `OpenMultitouchSupport` フレームワークにアクセス。Appleが見せたくないものを見る。ハッカー気分を味わう。App Storeからリジェクトされる。

### 2. ⚡ Swift 6.0 並行処理（Async/Await実践）

実践的な `AsyncStream` の使用法、`@MainActor` パターン、`Task` 管理。将来の雇用主は、この知識がマグカップ計量アプリから来たとは知らない。

### 3. 📊 信号処理（初心者向けDSP）

移動平均、変化率検出、安定性アルゴリズム。オーディオを処理しているように見える...実際はコーヒーマグのデータだけど。

### 4. 🎭 MVVM + 依存性注入（教科書通り）

プロトコルベースの抽象化、モックオブジェクト、テスト可能なアーキテクチャ。大半の本番アプリより良く書かれたジョークアプリ。

### 5. 🍎 macOS システム統合

Core Audio、AudioToolbox、entitlements。プログラムからシステム音量を制御。この力を善のために使え（これじゃなくて）。

---

## 🤝 コントリビュート（苦しみは分かち合うもの）

1. この悪い決断の記念碑を **Fork**
2. **ブランチを作成** (`git checkout -b feature/もっと悪いアイデア`)
3. **まずテストを書く**（基準はある、常識はない）
4. いい感じに **もっと悪く** する
5. **PRを提出** してサポートグループに参加

### まだ実装してないアイデア

- [ ] 頭を傾けて明るさを調整
- [ ] 周囲の音で壁紙を変更
- [ ] 室温でキーボードバックライトを調整
- [ ] モールス信号で瞬きしてメールを送信

---

## ⚠️ 免責事項（これはマジで読んで）

> **🚨 警告: ここは冗談じゃないセクション（皮肉にも）**
>
> - トラックパッドに重いものを置くな
> - ノートパソコンの近くに液体を置くな
> - 5万円のトラックパッド交換が必要になっても私たちを責めるな
> - これを本番で使うな（なんで使うの？）
> - これをIT部門に見せるな
> - Appleにこれを言うな
>
> **開発者が一切責任を負わないもの:**
> - 壊れたトラックパッド
> - こぼれたコーヒー
> - 困惑した家族
> - 失われた生産性
> - 存在危機
> - 同僚との関係悪化
> - Apple Genius Barの予約

---

## 🙏 謝辞

- [KrishKrosh/TrackWeight](https://github.com/KrishKrosh/TrackWeight) — 元祖マッドサイエンティスト
- 「最悪の音量UI」ミームコミュニティ — インスピレーションをくれて
- Appleのエンジニア — 絶対こうなることを意図していなかった
- 私たちのセラピスト — 話を聞いてくれて

---

## 📜 ライセンス

MIT License — カオスにも自由を。

このコードは好きなように使ってください。私たちに責任はありません。そもそも責任なんてなかった。

---

<div align="center">

**もっと分別があるべき開発者が 🤦 を込めて作りました**

*「勝つ唯一の方法はプレイしないこと」— でも私たちはプレイした*

⭐ このリポジトリにスターをつけて悪い行いを助長しよう ⭐

</div>
